{"version":3,"file":"vamtiger-generate-bundle-script.js","sources":["../source/vamtiger-generate-bundle-script.ts"],"sourcesContent":["import { resolve as resolvePath } from 'path';\nimport getFolderContent from 'vamtiger-get-directory-content';\nimport createFile from 'vamtiger-create-file';\nimport Args from 'vamtiger-argv/build/main';\nconst format = require('beautify');\n\ninterface IPackage {\n    name: string;\n    scripts: {\n        'bundle-source-main': string;\n        'bundle-source'?: string;\n    }\n}\n\nconst { stringify } = JSON;\nconst { cwd } = process;\nconst args = new Args();\nconst config = {\n    format: 'json'\n};\nconst packagePath = resolvePath(\n    cwd(),\n    'package'\n);\nconst packageJson = getPackageJson();\nconst sourceFolder = args.has('sourceFolder') && args.get('sourceFolder')\n    || args.has('s') && args.get('s')\n    || 'source';\nconst { name = '', scripts = {'bundle-source-main': ''} } = packageJson || {};\nconst { 'bundle-source-main': mainBundleScript } = scripts;\nconst fileName = new RegExp(name);\n\nif (!name) {\n    console.warn(`Failed to reference package name`);\n} else if (!scripts) {\n    console.warn(`Failed to reference package scripts`);\n} else if (!mainBundleScript) {\n    console.warn(`Failed to reference package.scripts['bundle-source-main']`);\n} else {\n    generateBundleScript();\n}\n\nfunction getPackageJson() {\n    try {\n        return require(packagePath) as IPackage;\n    } catch(error) {\n        console.warn(`Failed to load packge.json: ${packagePath}`);\n    }\n}\n\nasync function generateBundleScript() {\n    const folderContent = await getFolderContent(sourceFolder);\n    const scriptFiles = folderContent.filter(file => file.match(fileName));\n    const generatedBundleScript = scriptFiles\n        .map(fileName => `vamtiger-bundle-typescript --relativePath --entryFilePath source/${fileName} --bundleFilePath build/${fileName.split('.')[0]}.js --format iife --sourcemap true --copySourceMap --minify`)\n        .join(' && ');\n    const script = `${mainBundleScript} && ${generatedBundleScript}`;\n\n    if (packageJson && script) {\n        packageJson.scripts['bundle-source'] = script;\n\n        await createFile(`${packagePath}.json`, format(stringify(packageJson), config));\n    }\n}"],"names":["format","require","stringify","cwd","args","Args","config","packagePath","resolvePath","packageJson","getPackageJson","sourceFolder","has","get","_a","_b","name","_c","scripts","mainBundleScript","fileName","RegExp","error","console","warn","generateBundleScript","getFolderContent","folderContent","scriptFiles","filter","file","match","generatedBundleScript","map","split","join","script","createFile"],"mappings":"okBAIA,IAAMA,OAASC,QAAQ,YAUfC,yBACAC,gBACFC,KAAO,IAAIC,KACXC,QACFN,OAAQ,QAENO,YAAcC,aAChBL,MACA,WAEEM,YAAcC,iBACdC,aAAeP,KAAKQ,IAAI,iBAAmBR,KAAKS,IAAI,iBACnDT,KAAKQ,IAAI,MAAQR,KAAKS,IAAI,MAC1B,SACDC,mBAAEC,WAAAC,uBAAWC,cAAAC,iDACXC,+CACFC,SAAW,IAAIC,OAAOL,MAY5B,SAASN,iBACL,IACI,OAAOT,QAAQM,aACjB,MAAMe,GACJC,QAAQC,KAAK,+BAA+BjB,cAIpD,SAAekB,6IACW,SAAMC,iBAAiBf,6BAAvCgB,EAAgBb,SAChBc,EAAcD,EAAcE,OAAO,SAAAC,GAAQ,OAAAA,EAAKC,MAAMX,YACtDY,EAAwBJ,EACzBK,IAAI,SAAAb,GAAY,MAAA,oEAAoEA,6BAAmCA,EAASc,MAAM,KAAK,mEAC3IC,KAAK,QACJC,EAAYjB,wBAAuBa,EAErCvB,aAAe2B,GACf3B,YAAYS,QAAQ,iBAAmBkB,KAEjCC,WAAc9B,oBAAoBP,OAAOE,UAAUO,aAAcH,wBAAvEQ,yCA7BHE,KAEOE,QAEAC,iBAGRM,uBAFAF,QAAQC,KAAK,6DAFbD,QAAQC,KAAK,uCAFbD,QAAQC,KAAK"}