#!/usr/bin/env node
"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var path=require("path"),getFolderContent=_interopDefault(require("vamtiger-get-directory-content")),createFile=_interopDefault(require("vamtiger-create-file")),Args=_interopDefault(require("vamtiger-argv/build/main"));function __awaiter(e,r,a,t){return new(a||(a=Promise))(function(n,c){function i(e){try{s(t.next(e))}catch(e){c(e)}}function o(e){try{s(t.throw(e))}catch(e){c(e)}}function s(e){e.done?n(e.value):new a(function(r){r(e.value)}).then(i,o)}s((t=t.apply(e,r)).next())})}var format=require("beautify"),stringify=JSON.stringify,cwd=process.cwd,args=new Args,config={format:"json"},packagePath=path.resolve(cwd(),"package"),packageJson=getPackageJson(),sourceFolder=args.has("sourceFolder")&&args.get("sourceFolder")||args.has("s")&&args.get("s")||"source",_a=packageJson||{},_b=_a.name,name=void 0===_b?"":_b,_c=_a.scripts,scripts=void 0===_c?{"bundle-source-main":""}:_c,mainBundleScript=scripts["bundle-source-main"],fileName=new RegExp(name);function getPackageJson(){try{return require(packagePath)}catch(e){console.warn("Failed to load packge.json: "+packagePath)}}function generateBundleScript(){return __awaiter(this,void 0,void 0,function(){var e,r,a,t;return __generator(this,function(n){switch(n.label){case 0:return[4,getFolderContent(sourceFolder)];case 1:return e=n.sent(),r=e.filter(function(e){return e.match(fileName)}),a=r.map(function(e){return"vamtiger-bundle-typescript --relativePath --entryFilePath source/"+e+" --bundleFilePath build/"+e.split(".")[0]+".js --format iife --sourcemap true --copySourceMap --minify"}).join(" && "),t=mainBundleScript+" && "+a,packageJson&&t?(packageJson.scripts["bundle-source"]=t,[4,createFile(packagePath+".json",format(stringify(packageJson),config))]):[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})}name?scripts?mainBundleScript?generateBundleScript():console.warn("Failed to reference package.scripts['bundle-source-main']"):console.warn("Failed to reference package scripts"):console.warn("Failed to reference package name");
//# sourceMappingURL=vamtiger-generate-bundle-script.js.map
